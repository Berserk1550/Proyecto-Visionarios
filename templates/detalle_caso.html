<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Detalle del Caso</title>
</head>
<body>
    <h1>Detalle del Caso #{{ caso.num_caso }}</h1>

    <p><strong>Documento estudiante:</strong> {{ caso.documento }}</p>
    <p><strong>Tipo de caso:</strong> {{ caso.caso_tipo }}</p>
    <p><strong>Descripción:</strong> {{ caso.caso_descripcion }}</p>
    <p><strong>Fecha apertura:</strong> {{ caso.caso_fecha_apertura }}</p>
    <p><strong>Fecha cierre:</strong> {{ caso.caso_fecha_cierre or '---' }}</p>
    <p><strong>Estado:</strong> {{ caso.caso_estado }}</p>

    <h2>Intervenciones</h2>
    {% if intervenciones %}
    <table border="1">
        <thead>
            <tr>
                <th>Fecha</th>
                <th>Profesional</th>
                <th>Descripción</th>
                <th>Compromiso</th>
                <th>Estado compromiso</th>
            </tr>
        </thead>
        <tbody>
            {% for intervencion in intervenciones %}
            <tr>
                <td>{{ intervencion.fecha }}</td>
                <td>{{ intervencion.doc_pronal }}</td>
                <td>{{ intervencion.descripcion }}</td>
                <td>{{ intervencion.int_compromiso }}</td>
                <td>{{ intervencion.int_estado_compromiso }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p>No hay intervenciones registradas.</p>
    {% endif %}

    <div>
        <!-- Botón añadir intervención solo si el caso está abierto -->
        {% if session['rol'] in ['docente','coordinacion','profesional_apoyo','administrador'] and caso.caso_estado == 'abierto' %}
        <a href="{{ url_for('nueva_intervencion_form', num_caso=caso.num_caso) }}">
            <button>Añadir intervención</button>
        </a>
        {% endif %}

        <!-- Botón cerrar caso solo para admin -->
        {% if session['rol'] == 'administrador' and caso.caso_estado == 'abierto' %}
        <form action="{{ url_for('r_cerrar_caso', num_caso=caso.num_caso) }}" method="POST">
            <button type="submit">Cerrar caso</button>
        </form>
        {% endif %}
    </div>
</body>
</html>
